<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div class="container">
      <h1>JP&#39s Twittler</h1>
      <div class="buttons">
        <button type="button" class="btn btn-success" id="refreshButton">Click to Refresh</button>
        <button type="button" class="btn btn-danger" id="stopButton" style="display:none">Stop</button>
        <br>
        <br>
        <br>
      </div>

      <section class="tweets"></section>
    </div>
    
    <script>
      $(document).ready(function(){
        var $tweetSection = $('section.tweets');
        var intervalID = 0;

        //helper function to display tweets: adds tweet to top of section
        var displayTweet = function (tweet, $tweetLocation) {
          var $tweet = $('<div></div>');
          //use regular expression to get useful part of date
          var tweetTime = /\w{3} \w{3} \d{1,2} \d{4} \d{2}:\d{2}:\d{2}/.exec(tweet.created_at.toString());
          $tweet.text(tweetTime + ' @' + tweet.user + ': ' + tweet.message);
          $tweet.prependTo($tweetLocation)
        }

        //helper function to refresh and display new tweets
        var refreshTweets = function () {
          //check length of streams.home.  If it has changed, add new tweet
          if (streams.home.shown !== streams.home.length)
          {
            for (var i=streams.home.shown; i<streams.home.length; i++)
            {
              displayTweet(streams.home[i], $tweetSection);
            }

            //update new shown length
            streams.home.shown = streams.home.length;
          }

          return streams.home.shown;
        }

        //refresh once to display initial tweets
        streams.home.shown = 0;
        refreshTweets();
        
        $('#refreshButton').on('click', function () {
          refreshTweets();
          //Create an interval function that adds new tweets if streams.home.length has changed
          intervalID = setInterval(refreshTweets, 1500);
          $(this).text('Refreshing...');
          $('#stopButton').toggle();
        });

        $('#stopButton').on('click', function () {
          clearInterval(intervalID);
          $('#refreshButton').text('Click to Refresh');          
          $(this).toggle();          
        });

      });
    </script>
  </body>
</html>
